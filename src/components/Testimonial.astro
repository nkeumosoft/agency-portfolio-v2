---
// Importing testimonials
import testimonials from "../data/testimonials.json";
---

<div class="w-full flex flex-col py-[100px] space-y-6 overflow-x-hidden">
  <div class="w-full flex items-center">
    <div class="w-[15%] uppercase text-lg text-[#70707b] font-normal">
      what our clients say
    </div>
    <div class="w-[85%] border border-muted-background"></div>
  </div>

  <div class="w-full flex h-[400px] items-stretch">
    <!-- Left Column: Testimonials Text -->
    <div class="h-full w-3/5  space-y-10 relative">
      {testimonials.map((test, index) => (
        <div class="testimonial space-y-4 bg-white flex flex-col justify-between items-start w-full h-full absolute top-0 left-0">
          <p class="font-medium text-3xl">{test.testimonial}</p>
          <div class="name space-y-1">
            <div class="font-bold uppercase text-xs">{test.author}</div>
            <div class="text-agp-gray uppercase text-xs">{test.occupation}</div>
          </div>
        </div>
      ))}
    </div>

    <!-- Right Column: Avatars -->
    <div class="h-full w-2/5 flex flex-col items-end justify-end">
      <div class="flex items-center gap-2">
        {testimonials.map((test, index) => (
          <div class="bg-gray-400 avatar cursor-pointer rounded-full w-[60px] h-[60px]">
            <img
              src={test.url}
              alt={`Photo of ${test.author}`}
              class="h-full w-full object-cover rounded-full"
            />
          </div>
        ))}
      </div>
    </div>
  </div>
</div>

<script>
    import { gsap } from "@/utils/gsap";
  
    const avatars = gsap.utils.toArray<HTMLElement>('.avatar');
    const testimonialElements = gsap.utils.toArray<HTMLElement>('.testimonial');
  
    let activeIndex = 0;
  
    gsap.set(testimonialElements, { opacity: 0, pointerEvents: 'none' });
    gsap.set(testimonialElements[activeIndex], { opacity: 1, pointerEvents: 'auto' });
    gsap.set(avatars, { opacity: 0.5 });
    gsap.set(avatars[activeIndex], { opacity: 1 });
  
  
    avatars.forEach((avatar, index) => {
      avatar.addEventListener('click', () => {
        if (index === activeIndex) {
          return;
        }
   
        gsap.to(testimonialElements[activeIndex], {
          opacity: 0,
          pointerEvents: 'none',
          duration: 0.5,
          ease: "power1.inOut"
        });
  
     
        gsap.to(testimonialElements[index], {
          opacity: 1,
          pointerEvents: 'auto', 
          duration: 0.5,
          delay: 0.1,  
          ease: "power1.inOut"
        });
  
        
        gsap.to(avatars[activeIndex], {
            opacity: 0.5,
            duration: 0.3
        });
        gsap.to(avatars[index], {
            opacity: 1,
            duration: 0.3
        });
  
        activeIndex = index;
      });
    });
  </script>